# DisPatcher Agent の概要・作成手順

## 概要

ディスパッチャーエージェントは、ユーザーのクエリを内容に基づいて最適なハンドラーまたは「ツール」にインテリジェントにルーティングするために設計された高度なシステムです。このシステムは、言語モデルの能力と事前に定義されたツールのセットを利用して、クエリを効果的に処理し、応答します。ディスパッチャーエージェントは、特殊な処理が必要なさまざまなトピックにわたるクエリを処理する環境に特に有用です。

## 目的

ディスパッチャーエージェントの主な目的は以下の通りです：

    ユーザーの入力を明確なカテゴリまたは宛先に効率的に分類します。
    分類された入力を、それらの特定タイプのクエリを扱うために特別に設計された専門のツールに委譲します。
    さまざまなツールをシームレスに統合する統合ポイントを提供し、ユーザーのクエリを処理するためのモジュラーでスケーラブルなアプローチを可能にします。

## 主要コンポーネント

    DispatcherAgent: ユーザーの入力を受け取り、入力を処理する適切なツールを決定し、入力をそのツールにルーティングするコアクラス。

    BaseToolAgent: すべてのツールの基底クラス。各特定のツールは、このクラスから継承し、それが受け取る入力を処理するためのロジックを実装する必要があります。

    MainDispatcherAgent: BaseDispatcherAgentのサブクラスで、特定のツールが定義され、ディスパッチャーエージェントシステムに統合されます。

    Tools: 入力に基づいて特定のアクションを実行する事前定義されたハンドラー。例えば、検索、手続き処理、占星術、勉強の手助け、翻訳、一般的なクエリのためのデフォルトハンドラーなどがあります。

    DestinationOutputParser: ディスパッチャーエージェントの出力を解析し、選択された宛先/ツールを特定するクラス。

    プロンプトテンプレート: 言語モデルとのやり取りを構築するために定義され、ユーザー入力に基づいて適切なツールを選択するように案内します。

## 実装手順

ステップ1: ツールエージェントの定義

提供された機能ごとにBaseToolAgentのサブクラスを実装します。各ツールエージェントは、それが設計された入力を処理するためのロジックを実装する必要があります。

```python

class SearchAgent(BaseToolAgent):
    def run(self, input) -> str:
        # 検索クエリを処理するための実装

ステップ2: ツールをMainDispatcherAgentに統合する

MainDispatcherAgentクラスで、define_toolsメソッドをオーバーライドし、ディスパッチャーエージェントが使用するツール（BaseToolAgentのサブクラスのインスタンス）のリストをインスタンス化して返します。

```python

def define_tools(self):
    return [
        Tool.from_function(func=self.search_agent.run, name="search", description="...", args_schema=...),
        # 他のツール
    ]

ステップ3: DispatcherAgentのインスタンス化と使用

言語モデル、メモリ、ツールを含む必要なパラメータを提供してMainDispatcherAgentのインスタンスを作成します。ユーザー入力を処理するためにrunメソッドを使用します。

```python

dispatcher_agent = MainDispatcherAgent(llm, memory, readonly_memory, chat_history, verbose)
response = dispatcher_agent.run(user_message)

## 注意点

ディスパッチャーエージェントフレームワークは、ユーザークエリを最も適切なハンドラーに効率的にルーティングする柔軟で効率的な方法を提供します。特定のツールエージェントを定義し、それらをディスパッチャーエージェントシステムに統合することにより、開発者は幅広いユーザークエリを処理するためのモジュラーでスケーラブルなソリューションを作成することができます。
